<app-route-wrap [cardView]="false">
    <div page-card-title>Map</div>
    <div page-card-button>
        <button type="button" mat-flat-button color="primary" (click)="add()">Add image</button>
    </div>
    <div page-content>
        <mat-card>
            <div class="row map-wrap">
                <form [formGroup]="mapForm">
                    <div class="form-input">
                        <mat-form-field>
                            <input [formControlName]="'distance'" type="email" matInput placeholder="Distance(km)">
                            <mat-error *ngIf="mapForm.controls['distance'].invalid">{{getErrorMessage('distance')}}</mat-error>
                        </mat-form-field>
                    </div>
                </form>
                <agm-map #map class="map" [usePanning]="true" [latitude]="coords.lat" [longitude]="coords.lng" [fitBounds]="true" (mapReady)="mapReady($event)" (mapClick)="add($event)">
                    <agm-marker *ngFor="let pin of pins" [latitude]="pin.location.lat" [longitude]="pin.location.lng">
                        <agm-info-window>
                            <div class="marker">
                                <img src="{{pin.path}}" class="marker-image">
                                <button type="button" class="marker-btn" mat-flat-button color="primary" (click)="openDetailedView(pin)">Open Detailed</button>
                            </div>
                        </agm-info-window>
                    </agm-marker>
                </agm-map>
                <button type="button" class="search-btn" mat-flat-button color="primary" (click)="getList()">Search here</button>
            </div>
        </mat-card>
        <mat-card *ngIf="preview" class="preview">
            <img id="preview" src="{{preview.path}}" class="preview-image">
        </mat-card>
        <div *ngIf="preview">
            <mat-card class="preview" *ngFor="let comment of comments">
                <div class="comment-section">
                    <div class="comment">
                        <div class="comment-text">{{ comment.text }}</div>
                        <div class="comment-date">{{ comment.createdAt | date }}</div>
                    </div>
                </div>
            </mat-card>
            <div class="add-comment">
                <textarea matInput cols="3" rows="4" #comment class="comment-input"></textarea>
                <button type="button" class="add-comment-btn" mat-flat-button color="primary" (click)="leaveComment(comment.value, preview.id)">Leave comment</button>
            </div>
        </div>
    </div>
</app-route-wrap>
